# 2030세대의 주문건수 예측
<img width="889" alt="스크린샷 2023-04-02 오후 4 54 28" src="https://user-images.githubusercontent.com/123061697/229340025-a5a03798-7395-49f3-ba57-63ae8b46c17f.png" width="10" height="250">

-----

## INDEX

1. [프로젝트 소개](#1-프로젝트-소개)
2. [데이터 소개](#2-데이터-소개)
3. [EDA](#3-eda)
4. [데이터 전처리](#4-데이터-전처리)
5. [모델링](#5-모델링)
6. [REVIEW](#6-review)
----

## 1. 프로젝트 소개
### ☁️ 1-1. 프로젝트 기간
2023.03.01 ~ 2023.03.16

### ☁️ 1-2. 주제선정 및 목표
- 주제선정
  - 2019년 말부터 코로나가 시작되며 재택근무 활성화나 사회적 거리두기로 인해 자연스럽게 배달시장이 발전하는 계기가 되었고 
최근 통계청의 자료에 따르면 온라인을 통한 음식 배달업은 매년 75%, 최근 2년간 연평균 성장률은 163%로 가파른 성장세를 보이고 있습니다
  - 그중에서도 2030세대의 결제금액 비율이 높은 것으로 나타났다는 기사를 바탕으로 실제로 연령대 요소로 인해 주문하는 음식 카테고리 및 전체 배달건수가 달라지는지는지 eda 및 모델링을 진행하였습니다.

- 목표
  - 2030세대의 배달 주문건수 예측
  - 최종적으로 배달 요식업 종사자들에게 효율적인 경영전략을 제공
  
----

## 2. 데이터 소개
### ☁️ 2-1. 날씨별 배달 품목 차이(출처:[KT 빅데이터 플랫폼](https://www.bigdata-telecom.kr/invoke/SOKBP2603/?goodsCode=KGUWTHRDLVRDF))
- 2019.08 ~ 2020.07까지 지역별, 날씨별 배달 카테고리 주문건수 확인 가능

<img width="1266" alt="스크린샷 2023-04-02 오후 5 34 57" src="https://user-images.githubusercontent.com/123061697/229341936-fcb058ae-0f5d-422e-8f17-053d8e47f7dd.png">

### ☁️ 2-2. population_raw
- eda과정 중 사용한 인구 데이터
- 지역별, 나이별 인구수 확인 가능

<img width="1266" alt="스크린샷 2023-04-02 오후 5 35 11" src="https://user-images.githubusercontent.com/123061697/229342154-fb1f3c7c-52b7-4bb1-be25-7c464680861b.png">

----

## 3. EDA

### ☁️ 3-1. 데이터 기본형태 생성
- 배달 데이터에 카테고리별 배달건수를 다 더한 배달건수_합계 컬럼 추가
- 필요없는 컬럼 제거(날씨 관련 컬럼)
- 광역도시명, 시군구명을 이용해 지역명을 key값으로 생성하여 ID 컬럼 추가
- 데이터프레임명 : delivery

![스크린샷 2023-04-02 오후 6 05 20](https://user-images.githubusercontent.com/123061697/229343290-b8b74d4c-8e4d-45a5-ad17-a4a39d60929b.png)


- 컬럼 이름 변경
  - 행정구역(동읍면)별(1) > 광역도시명
  - 행정구역(동읍면)별(2) > 시군구명
  - 계 > 인구수
  - 항목 > 구분
  
- 소계 제거
- 구분 하위항목 남자, 여자, 합계로 변경
- 데이터프레임명 : population
  
![스크린샷 2023-04-02 오후 6 06 39](https://user-images.githubusercontent.com/123061697/229343356-95e0f314-2cb9-48cb-8b26-acded587f0b3.png)

### ☁️ 3-2. 2030세대 비율이 많은 지역과 배달량이 많은 지역의 상관관계 확인
- delivery 시군구별로 그룹화
- population 20-39세 컬럼 추가(20-24, 25-29, 30-34, 35-39)
- 2030합계 상위 20개 지역 추출
- 배달건수합계 상위 20개 지역 추출
- 각각 위도, 경도 추가
- 지도 시각화

![스크린샷 2023-04-02 오후 6 20 13](https://user-images.githubusercontent.com/123061697/229343998-52c74b60-9074-4fc6-a64d-b8dff188d1a5.png)


- 두 데이터가 완벽하게 일치하지는 않지만 2030이 많은 서울, 경기 지역이 대체로 배달 주문건수가 많음
- 그렇다면 가장 많은 배달음식을 소비하는 지역은 어디일까?

### ☁️ 3-3. 가장 많은 배달음식을 소비하는 지역
- delivery 광역도시별, 시군구별 배댤건수 합계 기준으로 정렬
- 가지고 있는 데이터에서 가장 많은 배달음식 소비지역은 의정부로 나타남

![스크린샷 2023-04-02 오후 6 26 22](https://user-images.githubusercontent.com/123061697/229344317-0758df3f-8bd2-497f-ab5d-4047639a28db.png)

### ☁️ 3-4. MZ, X, Y, 노령층(각 세대별)에 따라 달라지는 주문량과 배달 카테고리 확인

 - 노년층 : Y세대 
 - Y세대 : 1946년\~1965년생(58세\~77세)
 - X세대 : 1960년대와 1970년대생(44세\~63세)
 - MZ세대 : 1981\~1996년생(27세\~42세)
- 위의 기준으로 population에 새로운 컬럼 생성
- ID기준으로 delivery와 merge
- 각 세대별 상위 10개지역 추출 후 카테고리별 배달건수 확인
1) MZ세대

<img alt="스크린샷 2023-04-02 오후 6 32 05" src="https://user-images.githubusercontent.com/123061697/229344625-6184692a-60dc-4954-9768-79a396bd12a2.png" width="500" height="400">

2) X세대

<img alt="스크린샷 2023-04-02 오후 6 33 06" src="https://user-images.githubusercontent.com/123061697/229344661-ecbc6151-461a-4295-accf-71acdaece809.png" width="500" height="400">

3) Y세대

<img alt="스크린샷 2023-04-02 오후 6 40 17" src="https://user-images.githubusercontent.com/123061697/229344981-656bb46d-5d68-498d-90ae-2f94520f9d60.png" width="500" height="400">

4) 노년층

<img alt="스크린샷 2023-04-02 오후 6 41 58" src="https://user-images.githubusercontent.com/123061697/229345051-1d40c2de-c6e3-4313-b852-f87874e8b393.png" width="500" height="400">

- 2030(MZ)세대에서는 역시나 치킨을 가장 많이 시켜먹고, 다른 연령대에 비해 모든 카테고리를 고르게 소비하는 경향이 보임
- 65~69세(X)세대는 족발/보쌈을 가장 많이 시켜먹었고, 한식과 치킨이 그 뒤를 이음
- 특이한 점은 70~79세(Y)세대와 노년층 세대인데, 이들은 의외로 패스트푸드를 가장 먹음
- 그 뒤로 치킨이 2번째로 높았는데 치아상태가 좋지않으신 분들임을 고려한다면, 이 역시 70세이상 어르신들이 먹는다기보다는 자녀들을 위한 것으로 보임

### ☁️ 3-5. 크리스마스, 신정 vs 설날, 추석
- 크리스마스와 신정은 연인이나 친구를 주로 만나고 설날, 추석은 가족을 주로 만난다
- 크리스마스 신정에 2030이 많은 지역의 배달 카테고리와 설날, 추석에 고령층이 많은 지역의 배달 카테고리 차이 확인
- 친구를 만날때와 가족을 만날때 시키는 배달 카테고리가 달라지는지 확인
    - 2019년 연휴 : 8/15(목) , 9/12\~9/15(목~일), 10/3(목), 10/9(수), 12/25(수)
    - 2020년 연휴 : 1/1(수), 1/24\~1/26(금~일), 3/1(일), 4/30(목), 5/5(화), 6/6(토)

1) 크리스마스, 신정

![스크린샷 2023-04-02 오후 6 46 49](https://user-images.githubusercontent.com/123061697/229345319-2908d4c0-04ad-4ec4-9575-28d81ecde562.png)

2) 설날, 추석

![스크린샷 2023-04-02 오후 6 47 41](https://user-images.githubusercontent.com/123061697/229345360-68285335-def4-46fa-9344-14165bce12c6.png)

- 크리스마스, 신정보다 설날, 추석이 날짜수가 더 많았음에도 불구하고 2030 지역의 배달량이 훨씬 더 많은것을 알 수 있었다
- 2030이 많은 지역은 다양한 품목을 주문하는 경향이 있지만 그중에서도 치킨과 카페의 비율이 높았다
- 고령층이 많은 지역은 카페와 패스트푸드의 주문량이 많았다

### ☁️ 3-6. 2030의 성별에 따라 많이 주문하는 배달 품목이 달라지는지 확인
- 남자 인구수 많은 순으로 정렬한 df생성
 - 카테고리별 합계 확인
- 여자 인구수 많은 순으로 정렬한 df생성
 - 카테고리별 합계 확인
 
 <img alt="스크린샷 2023-04-02 오후 6 53 09" src="https://user-images.githubusercontent.com/123061697/229345637-a8088199-fb64-417b-bdd2-f2cee838aa53.png" width="700" height="400">

- 2030 중 대체로 여자가 많은 지역이 남자가 많은 지역보다 모든 카테고리의 주문건수가 높음
- 그중 치킨, 족발, 분식은 다른 카테고리보다 더 많은 차이를 보임

### ☁️ 3-7. 20대, 30대의 배달 주문량 차이와 카테고리 확인
- 20대, 30대로 연령대를 나누어 각각 배달건수가 많은 순으로 정렬
- 카테고리별 합계 확인

 <img alt="스크린샷 2023-04-02 오후 7 00 06" src="https://user-images.githubusercontent.com/123061697/229345976-30088c40-241b-4e87-9882-f34a72109886.png" width="700" height="400">

- 아시안/양식, 중식, 패스트푸드는 20대와 30대 배달건수가 거의 비슷함
- 위의 카테고리를 제외한 나머지는 20대의 배달 주문량이 더 많은 것을 알 수 있음

### ☁️ 3-8. 2030이 많은 지역의 월별 인기있는 배달 카테고리 확인
- 2030이 많은 지역 상위 10개 월별로 집계
- heatmap

 <img alt="스크린샷 2023-04-02 오후 7 03 31" src="https://user-images.githubusercontent.com/123061697/229346158-2552db19-fc47-4b8d-9a67-4a690478a66e.png" width="500" height="500">

- 월별 전체 주문건수
 <img alt="스크린샷 2023-04-02 오후 7 05 17" src="https://user-images.githubusercontent.com/123061697/229346272-2e1c29bd-c634-4a0f-ac13-643e00b4148d.png" width="700" height="400">

- 치킨, 카페는 모든 월에서 비슷하게 주문량이 많은 것을 알 수 있다
- 족발은 여름철에 주문량이 증가하고 도시락은 봄, 한식은 겨울철에 주문량이 좀 더 증가하는 것 같다
- 전체 월에서는 7월의 총 주문량이 가장 높다

지금까지의 분석 과정을 통해 음식 배달건수는 연령대, 세대, 지역 등과 상관관계가 있다고 해석할 수 있고 이를 통해 가장 주문량이 많았던 2030세대의 배달건수를 예측해보는 모델링을 진행

----

## 4. 데이터 전처리
- delivery, population ID기준으로 merge
- 결측치 제거
  - nan값 제거 
  
 - 사용했던 delivery 데이터는 eda과정에서는 이상치가 눈에띄게 드러나지 않았지만 모델링을 진행하면서 확인해본 결과 배달건수가 비정상적으로 적거나 한쪽으로 치우친 데이터 존재
 - 이상치 제거하지 않았을 때보다 이상치를 제거했을 때 모델의 성능이 더 좋아지는 것 확인
 - 3사분위수와 1사분위수를 확인 후 벗어나는 데이터들을 이상치로 판단해 제거
 - 이상치 제거 후 배달건수 합계의 boxplot 확인
 
 <img alt="스크린샷 2023-04-02 오후 7 25 38" src="https://user-images.githubusercontent.com/123061697/229347332-571f8eb7-4a28-47f6-b98a-18e27fd8a9f4.png" width="600" height="400">

- 3사분위수보다 크고, 1사분위수보다 작은 이상치들을 제거했지만 여전히 이상치들이 존재
- 데이터를 확인해보니 배달건수 합계가 1인 값이 존재해 1사분위수가 낮게 나왔고 이후 2차적으로 배달건수 합계가 1인 값과 3사분위수와 1사분위수를 이용하여 한번 더 이상치를 제거
- boxplot 확인

<img alt="ᅳ크린샷 2023-04-02 오후 9 33 06" src="https://user-images.githubusercontent.com/123061697/229352994-ded2cfba-b1d1-40d3-ba8a-fd1af303a8e0.png" width="600" height="400">

- 여전히 이상치들이 존재하지만 이 이상으로 이상치를 제거하면 데이터수 부족으로 성능이 더 떨어지게 되어 마무리
- X_train : ID, 20-24세, 25-29세, 30-34세, 35-39세

![스크린샷 2023-04-02 오후 10 02 18](https://user-images.githubusercontent.com/123061697/229354522-45584089-8029-4ccf-9b8e-0307519c2c1e.png)

- y_train : 배달건수_합계

![스크린샷 2023-04-02 오후 10 02 28](https://user-images.githubusercontent.com/123061697/229354542-2f1f5ae1-4b68-4221-8cbf-4c765afdb2da.png)

- MinMaxScaler를 이용해 스케일링 및 변수형 변수 LabelEncoder 적용
- train_test_split 이용하여 train 데이터와 test 데이터 분리

----

## 5. 모델링
### ☁️ 5-1. mse, rmse
- 가장 최적의 모델을 찾기 위해 5가지 모델의 mse, rmse 테스트
- 각각 train 데이터로 학습 후 test 데이터로 predict

|   | mse | rmse |
|---|----|----|
| RandomForestRegressor | 1681428 | 1296 |
| XGBRegrossor | 2345974 | 1531 |
| LinearRegression | 1853054 | 1361 |
| Ridge | 1480856 | 1216 |
| SVR | 1971462 | 1404 |

- RandomForestRegressor와 Ridge의 rmse가 가장 낮게 나옴

### ☁️ 5-2. GridSearchCV
- 더 다양한 파라미터를 이용해 모델의 성능을 증가시키기 위해 GridSearchCV를 사용해 RandomForestRegressor 모델링
- 베스트 파라미터 활용하여 max_depth=20, min_samples_leaf=4, min_samples_split=8, n_estimators=50으로 설정

![스크린샷 2023-04-02 오후 9 50 21](https://user-images.githubusercontent.com/123061697/229353874-c85490d3-91de-4046-9856-45d47244e885.png)

|   | mse | rmse |
|---|----|----|
| RandomForestRegressor | 1354567 | 1163 |

- rmse값이 조금 더 낮아진 것 확인 가능
- rmse가 1163으로 가장 낮은 GridSearchCV를 사용한 RandomForestRegressor모델을 최종적으로 선정

----

## 6. REVIEW

### ☁️ 6-1. 한계점
```
- 해당 기업의 실제 배달량 편차가 클수도 있지만 전국을 기준으로 수집하다보니 누락된 데이터 다수 존재
- 지역별로, 날짜별로, 카테고리별로 배달량의 편차가 컸고 따라서 회귀모델로 예측하는 단계에서 오차가 커졌다고 예상
- 이상치 제거로 인해 부족한 데이터의 양
- 더 다양한 방법을 시도해보지 못한 아쉬움
```

## TEAM
- 김정빈
- 박건우
- 윤정옥
